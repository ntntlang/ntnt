<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IAL Explorer - Intent Assertion Language</title>
    <style>
      :root {
        --bg-primary: #0d1117;
        --bg-secondary: #161b22;
        --bg-tertiary: #21262d;
        --bg-elevated: #1c2128;
        --border: #30363d;
        --border-hover: #484f58;
        --text-primary: #e6edf3;
        --text-secondary: #8b949e;
        --text-muted: #6e7681;
        --green: #3fb950;
        --green-bg: rgba(63, 185, 80, 0.15);
        --red: #f85149;
        --red-bg: rgba(248, 81, 73, 0.15);
        --yellow: #d29922;
        --yellow-bg: rgba(210, 153, 34, 0.15);
        --blue: #58a6ff;
        --blue-bg: rgba(88, 166, 255, 0.15);
        --purple: #a371f7;
        --purple-bg: rgba(163, 113, 247, 0.15);
        --orange: #f0883e;
        --orange-bg: rgba(240, 136, 62, 0.15);
        --teal: #39c5cf;
        --teal-bg: rgba(57, 197, 207, 0.15);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        font-size: 14px;
      }

      /* Header */
      .header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 50;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
        font-size: 16px;
      }

      .logo .ial {
        color: var(--purple);
      }

      .header-subtitle {
        color: var(--text-muted);
        font-size: 13px;
        font-weight: 400;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .file-select {
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 8px 12px;
        color: var(--text-primary);
        font-size: 13px;
        cursor: pointer;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.1s ease;
      }

      .btn-secondary {
        background: var(--bg-tertiary);
        border-color: var(--border);
        color: var(--text-primary);
      }

      .btn-secondary:hover {
        background: var(--bg-elevated);
        border-color: var(--border-hover);
      }

      /* Main container */
      .container {
        display: grid;
        grid-template-columns: 1fr 350px;
        min-height: calc(100vh - 60px);
      }

      @media (max-width: 900px) {
        .container {
          grid-template-columns: 1fr;
        }
        .sidebar {
          display: none;
        }
      }

      /* Intent file view */
      .intent-view {
        padding: 24px;
        overflow-y: auto;
      }

      .intent-content {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px 24px;
        font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
        font-size: 13px;
        line-height: 1.7;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      /* Syntax highlighting */
      .intent-content .comment {
        color: var(--text-muted);
      }

      .intent-content .section-header {
        color: var(--purple);
        font-weight: 600;
      }

      .intent-content .keyword {
        color: var(--orange);
        font-weight: 500;
      }

      .intent-content .feature-name {
        color: var(--blue);
        font-weight: 500;
      }

      .intent-content .string {
        color: var(--green);
      }

      .intent-content .arrow {
        color: var(--teal);
        font-weight: 600;
      }

      .intent-content .separator {
        color: var(--text-muted);
      }

      /* Glossary terms - the magic! */
      .glossary-term {
        background: var(--purple-bg);
        color: var(--purple);
        padding: 1px 4px;
        border-radius: 3px;
        cursor: help;
        transition: all 0.15s ease;
        position: relative;
      }

      .glossary-term:hover {
        background: rgba(163, 113, 247, 0.35);
        box-shadow: 0 0 0 2px rgba(163, 113, 247, 0.3);
      }

      .glossary-term.level-1 {
        background: var(--blue-bg);
        color: var(--blue);
      }

      .glossary-term.level-1:hover {
        background: rgba(88, 166, 255, 0.35);
        box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.3);
      }

      .glossary-term.level-2 {
        background: var(--teal-bg);
        color: var(--teal);
      }

      .glossary-term.level-2:hover {
        background: rgba(57, 197, 207, 0.35);
        box-shadow: 0 0 0 2px rgba(57, 197, 207, 0.3);
      }

      .glossary-term.primitive {
        background: var(--green-bg);
        color: var(--green);
      }

      .glossary-term.primitive:hover {
        background: rgba(63, 185, 80, 0.35);
        box-shadow: 0 0 0 2px rgba(63, 185, 80, 0.3);
      }

      /* Popover that follows mouse */
      .popover {
        position: fixed;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px;
        min-width: 320px;
        max-width: 450px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        transform: translateY(8px);
        transition: opacity 0.15s ease, transform 0.15s ease;
      }

      .popover.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .popover-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .popover-title .term-badge {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: 500;
      }

      .popover-title .term-badge.glossary {
        background: var(--purple-bg);
        color: var(--purple);
      }

      .popover-title .term-badge.primitive {
        background: var(--green-bg);
        color: var(--green);
      }

      /* Resolution chain in popover */
      .resolution-chain {
        font-family: ui-monospace, monospace;
        font-size: 12px;
      }

      .resolution-step {
        display: flex;
        align-items: flex-start;
        gap: 8px;
        padding: 6px 0;
        border-left: 2px solid var(--border);
        padding-left: 12px;
        margin-left: 4px;
      }

      .resolution-step:first-child {
        border-left-color: var(--purple);
      }

      .resolution-step.level-1 {
        margin-left: 20px;
        border-left-color: var(--blue);
      }

      .resolution-step.level-2 {
        margin-left: 36px;
        border-left-color: var(--teal);
      }

      .resolution-step.primitive {
        margin-left: 52px;
        border-left-color: var(--green);
      }

      .step-arrow {
        color: var(--text-muted);
        flex-shrink: 0;
      }

      .step-term {
        color: var(--purple);
      }

      .step-term.level-1 {
        color: var(--blue);
      }

      .step-term.level-2 {
        color: var(--teal);
      }

      .step-term.primitive {
        color: var(--green);
        font-weight: 500;
      }

      .step-source {
        color: var(--text-muted);
        font-size: 10px;
        margin-left: auto;
      }

      /* Primitive check box */
      .primitive-checks {
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 10px 12px;
        margin-top: 12px;
        font-size: 11px;
      }

      .primitive-checks-title {
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 10px;
        margin-bottom: 8px;
      }

      .primitive-check {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 3px 0;
        font-family: ui-monospace, monospace;
        color: var(--green);
      }

      .primitive-check .check-icon {
        opacity: 0.7;
      }

      /* Sidebar - Glossary reference */
      .sidebar {
        background: var(--bg-secondary);
        border-left: 1px solid var(--border);
        padding: 20px;
        overflow-y: auto;
      }

      .sidebar-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-muted);
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border);
      }

      .glossary-list {
        list-style: none;
      }

      .glossary-item {
        padding: 10px 12px;
        margin-bottom: 6px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.1s ease;
      }

      .glossary-item:hover {
        background: var(--bg-elevated);
        border-left: 3px solid var(--purple);
        padding-left: 9px;
      }

      .glossary-item .term {
        font-weight: 500;
        color: var(--purple);
        font-size: 13px;
        margin-bottom: 4px;
      }

      .glossary-item .means {
        font-size: 12px;
        color: var(--text-secondary);
        font-family: ui-monospace, monospace;
      }

      /* Legend */
      .legend {
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 20px;
      }

      .legend-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-muted);
        margin-bottom: 10px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 0;
        font-size: 12px;
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
      }

      .legend-color.glossary { background: var(--purple-bg); border: 1px solid var(--purple); }
      .legend-color.level-1 { background: var(--blue-bg); border: 1px solid var(--blue); }
      .legend-color.level-2 { background: var(--teal-bg); border: 1px solid var(--teal); }
      .legend-color.primitive { background: var(--green-bg); border: 1px solid var(--green); }

      /* Instructions */
      .instructions {
        background: var(--blue-bg);
        border: 1px solid rgba(88, 166, 255, 0.3);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
        font-size: 13px;
        color: var(--blue);
      }

      .instructions strong {
        display: block;
        margin-bottom: 6px;
      }

      /* Mockup label */
      .mockup-label {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--yellow);
        color: #000;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <img
          src="data:image/png;base64,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"
          alt="NTNT"
          style="height: 24px; width: 24px; vertical-align: middle; margin-right: 8px"
        />NTNT <span class="ial">IAL</span> Explorer
        <span class="header-subtitle">Intent Assertion Language Visualizer</span>
      </div>
      <div class="header-right">
        <a href="studio-mockup-v2.html" class="btn btn-secondary" style="text-decoration: none;">← Back to Studio</a>
        <select class="file-select">
          <option>ntnt-lang-org/server.intent</option>
          <option>ial_demo/server.intent</option>
          <option>snowgauge/snowgauge.intent</option>
        </select>
      </div>
    </header>

    <div class="container">
      <div class="intent-view">
        <div class="instructions">
          <strong>✨ Hover over highlighted terms to see the magic of IAL decomposition</strong>
          Move your mouse over any purple-highlighted term to see how natural language assertions resolve into executable checks.
        </div>

        <div class="intent-content" id="intent-content">
<span class="comment"># NTNT Language Website</span>
<span class="comment"># Official website for ntnt-lang.org</span>
<span class="comment"># Run: ntnt intent check server.tnt</span>

<span class="section-header">## Overview</span>
A clean, modern website introducing the NTNT programming language.
Built with NTNT's file-based routing, external templates, and middleware.

<span class="separator">---</span>

<span class="section-header">## Glossary</span>

| Term | Means |
|------|-------|
| <span class="glossary-term" data-term="a visitor goes to the home page">a visitor goes to the home page</span> | GET / |
| <span class="glossary-term" data-term="a visitor goes to the learn page">a visitor goes to the learn page</span> | GET /learn |
| <span class="glossary-term" data-term="a visitor goes to the blog">a visitor goes to the blog</span> | GET /blog |
| <span class="glossary-term" data-term="page loads successfully">page loads successfully</span> | status 200, <span class="glossary-term" data-term="returns HTML">returns HTML</span> |
| <span class="glossary-term" data-term="returns HTML">returns HTML</span> | header "Content-Type" contains "text/html" |
| <span class="glossary-term" data-term="has site branding">has site branding</span> | body contains "ntnt-logo", body contains "NTNT" |
| <span class="glossary-term" data-term="has powered badge">has powered badge</span> | body contains "Powered by NTNT", body contains "powered-badge" |
| <span class="glossary-term" data-term="has navigation">has navigation</span> | body contains "Learn", body contains "Blog" |
| <span class="glossary-term" data-term="has proper layout">has proper layout</span> | <span class="glossary-term" data-term="has site branding">has site branding</span>, <span class="glossary-term" data-term="has navigation">has navigation</span>, body contains "footer" |
| <span class="glossary-term" data-term="they see">they see "{text}"</span> | body contains "{text}" |
| <span class="glossary-term" data-term="they don't see">they don't see "{text}"</span> | body not contains "{text}" |
| <span class="glossary-term" data-term="page not found">page not found</span> | status 404 |
| <span class="glossary-term" data-term="blog post exists">blog post exists</span> | status 200, <span class="glossary-term" data-term="returns HTML">returns HTML</span> |

<span class="separator">---</span>

<span class="keyword">Feature:</span> <span class="feature-name">Homepage</span>
  id: feature.homepage
  description: <span class="string">"Landing page introducing NTNT with modern full-width hero and glass header"</span>

  <span class="keyword">Scenario:</span> Visitor discovers NTNT
    description: <span class="string">"A new visitor lands on the homepage and learns about NTNT"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the home page">a visitor goes to the home page</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="page loads successfully">page loads successfully</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="has proper layout">has proper layout</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Experimental"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Intent-Driven Development"</span>

  <span class="keyword">Scenario:</span> Visitor sees call-to-action
    description: <span class="string">"The homepage prominently displays action buttons"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the home page">a visitor goes to the home page</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Get Started"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Learn More"</span>

  <span class="keyword">Scenario:</span> Visitor sees feature highlights
    description: <span class="string">"The homepage highlights NTNT's key features"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the home page">a visitor goes to the home page</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Why NTNT?"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Full-Featured Language"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Design by Contract"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Intent Studio"</span>

<span class="separator">---</span>

<span class="keyword">Feature:</span> <span class="feature-name">Learn Page</span>
  id: feature.learn_page
  description: <span class="string">"Getting started guide and documentation links"</span>

  <span class="keyword">Scenario:</span> Developer reads the quick start guide
    description: <span class="string">"A developer visits the learn page to get started"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the learn page">a visitor goes to the learn page</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="page loads successfully">page loads successfully</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="has proper layout">has proper layout</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Installation"</span>

  <span class="keyword">Scenario:</span> Developer learns about IDD
    description: <span class="string">"The learn page explains Intent-Driven Development"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the learn page">a visitor goes to the learn page</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Intent-Driven Development"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "@implements"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "ntnt intent check"</span>

<span class="separator">---</span>

<span class="keyword">Feature:</span> <span class="feature-name">Blog List</span>
  id: feature.blog_list
  description: <span class="string">"Blog index showing all posts with excerpts"</span>

  <span class="keyword">Scenario:</span> Visitor browses the blog
    description: <span class="string">"A visitor views the list of blog posts"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the blog">a visitor goes to the blog</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="page loads successfully">page loads successfully</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="has proper layout">has proper layout</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Blog"</span>

  <span class="keyword">Scenario:</span> Blog shows available posts
    description: <span class="string">"The blog index lists all published posts"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the blog">a visitor goes to the blog</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Introducing NTNT"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Intent-Driven Development"</span>

<span class="separator">---</span>

<span class="keyword">Feature:</span> <span class="feature-name">Blog Post View</span>
  id: feature.blog_post
  description: <span class="string">"Individual blog post with full content"</span>

  <span class="keyword">Scenario:</span> Reading the introduction post
    description: <span class="string">"A visitor reads the introductory blog post about NTNT"</span>
    <span class="keyword">When</span> a visitor goes to /blog/introducing-ntnt-a-programming-language-for-the-ai-era
    <span class="arrow">→</span> <span class="glossary-term" data-term="blog post exists">blog post exists</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="has proper layout">has proper layout</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "Introducing NTNT"</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="they see">they see "NTNT Team"</span>

  <span class="keyword">Scenario:</span> Visiting a non-existent post
    description: <span class="string">"A visitor tries to access a post that doesn't exist"</span>
    <span class="keyword">When</span> a visitor goes to /blog/does-not-exist
    <span class="arrow">→</span> <span class="glossary-term" data-term="page not found">page not found</span>

<span class="separator">---</span>

<span class="keyword">Feature:</span> <span class="feature-name">Site Branding</span>
  id: feature.site_branding
  description: <span class="string">"Consistent branding elements across the site"</span>

  <span class="keyword">Scenario:</span> Footer shows NTNT attribution
    description: <span class="string">"The footer includes a 'Powered by NTNT' badge"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="a visitor goes to the home page">a visitor goes to the home page</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="has powered badge">has powered badge</span>

<span class="separator">---</span>

<span class="keyword">Feature:</span> <span class="feature-name">Text Utilities</span>
  id: feature.text_utilities
  description: <span class="string">"Utility functions for text processing used across the site"</span>
  source: lib/text.tnt

  <span class="keyword">Scenario:</span> Blog titles become clean URLs
    description: <span class="string">"Post titles are converted to URL-safe slugs"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="generating a slug from a title">generating a slug from a title</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="slug is URL-safe">slug is URL-safe</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="slug matches expected format">slug matches expected format</span>

  <span class="keyword">Scenario:</span> Slugs are predictable
    description: <span class="string">"The same title always produces the same slug"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="generating a slug from a title">generating a slug from a title</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="slug is predictable">slug is predictable</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="slug is stable">slug is stable</span>

  <span class="keyword">Scenario:</span> Slugs handle any input
    description: <span class="string">"Edge cases and weird inputs don't break slug generation"</span>
    <span class="keyword">When</span> <span class="glossary-term" data-term="generating a slug from user input">generating a slug from user input</span>
    <span class="arrow">→</span> <span class="glossary-term" data-term="slug is URL-safe">slug is URL-safe</span>

<span class="separator">---</span>

<span class="keyword">Constraint:</span> Responsive Design
  description: <span class="string">"Website should be mobile-friendly with proper viewport meta"</span>
  applies_to: [feature.homepage, feature.learn_page, feature.blog_list, feature.blog_post]

<span class="keyword">Constraint:</span> Accessible
  description: <span class="string">"Use semantic HTML, proper heading hierarchy, and sufficient contrast"</span>
  applies_to: [feature.homepage, feature.learn_page, feature.blog_list, feature.blog_post]

<span class="separator">---</span>
<span class="separator">---</span>

<span class="section-header">## System-Managed Sections</span>

<span class="comment">The sections below are managed by the system/agent. Humans confirm the scenarios above;
the system uses these sections to execute verification.</span>

<span class="separator">---</span>

<span class="section-header">## Glossary Extensions (Unit Testing)</span>

| Term | Means |
|------|-------|
| <span class="glossary-term" data-term="generating a slug from a title">generating a slug from a title</span> | call: slugify({title}), source: lib/text.tnt, input: test_data.slugify_examples |
| <span class="glossary-term" data-term="generating a slug from user input">generating a slug from user input</span> | call: slugify({input}), source: lib/text.tnt, input: corpus.strings |
| <span class="glossary-term" data-term="slug is URL-safe">slug is URL-safe</span> | check: invariant.url_slug |
| <span class="glossary-term" data-term="slug matches expected format">slug matches expected format</span> | result is {expected} |
| <span class="glossary-term" data-term="slug is predictable">slug is predictable</span> | property: deterministic |
| <span class="glossary-term" data-term="slug is stable">slug is stable</span> | property: idempotent |

<span class="separator">---</span>

<span class="section-header">## Invariants</span>

<span class="keyword">Invariant:</span> <span class="feature-name">URL Slug</span>
  id: invariant.url_slug
  description: <span class="string">"A URL-safe slug string"</span>

  Assertions:
    <span class="arrow">→</span> <span class="glossary-term primitive" data-term="uses only">uses only [a-z0-9-]</span>
    <span class="arrow">→</span> <span class="glossary-term primitive" data-term="is lowercase">is lowercase</span>
    <span class="arrow">→</span> <span class="glossary-term primitive" data-term="does not start with">does not start with "-"</span>
    <span class="arrow">→</span> <span class="glossary-term primitive" data-term="does not end with">does not end with "-"</span>
    <span class="arrow">→</span> <span class="glossary-term primitive" data-term="does not contain">does not contain "--"</span>
    <span class="arrow">→</span> <span class="glossary-term primitive" data-term="is non-empty">is non-empty</span>

<span class="separator">---</span>

<span class="section-header">## Test Data</span>

<span class="keyword">Test Cases:</span> <span class="feature-name">Slugify Examples</span>
  id: test_data.slugify_examples
  for: feature.text_utilities
  scenario: Blog titles become clean URLs

  | title | expected |
  | <span class="string">"Hello World"</span> | <span class="string">"hello-world"</span> |
  | <span class="string">"My First Post!"</span> | <span class="string">"my-first-post"</span> |
  | <span class="string">"What's the Deal?"</span> | <span class="string">"whats-the-deal"</span> |
  | <span class="string">"UPPERCASE TITLE"</span> | <span class="string">"uppercase-title"</span> |
  | <span class="string">"  Extra   Spaces  "</span> | <span class="string">"extra-spaces"</span> |
  | <span class="string">"Introducing NTNT: A Programming Language for the AI Era"</span> | <span class="string">"introducing-ntnt-a-programming-language-for-the-ai-era"</span> |
        </div>
      </div>

      <div class="sidebar">
        <div class="legend">
          <div class="legend-title">Resolution Depth</div>
          <div class="legend-item">
            <div class="legend-color glossary"></div>
            <span>Glossary term (Level 0)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color level-1"></div>
            <span>Expanded term (Level 1)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color level-2"></div>
            <span>Nested term (Level 2)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color primitive"></div>
            <span>Primitive check (executable)</span>
          </div>
        </div>

        <div class="sidebar-title">Glossary Terms (19)</div>
        <ul class="glossary-list">
          <li class="glossary-item" data-term="a visitor goes to the home page">
            <div class="term">a visitor goes to the home page</div>
            <div class="means">→ GET /</div>
          </li>
          <li class="glossary-item" data-term="a visitor goes to the learn page">
            <div class="term">a visitor goes to the learn page</div>
            <div class="means">→ GET /learn</div>
          </li>
          <li class="glossary-item" data-term="a visitor goes to the blog">
            <div class="term">a visitor goes to the blog</div>
            <div class="means">→ GET /blog</div>
          </li>
          <li class="glossary-item" data-term="page loads successfully">
            <div class="term">page loads successfully</div>
            <div class="means">→ status 200, returns HTML</div>
          </li>
          <li class="glossary-item" data-term="has proper layout">
            <div class="term">has proper layout</div>
            <div class="means">→ has site branding, has navigation, body contains "footer"</div>
          </li>
          <li class="glossary-item" data-term="has site branding">
            <div class="term">has site branding</div>
            <div class="means">→ body contains "ntnt-logo", body contains "NTNT"</div>
          </li>
          <li class="glossary-item" data-term="has navigation">
            <div class="term">has navigation</div>
            <div class="means">→ body contains "Learn", body contains "Blog"</div>
          </li>
          <li class="glossary-item" data-term="has powered badge">
            <div class="term">has powered badge</div>
            <div class="means">→ body contains "Powered by NTNT", body contains "powered-badge"</div>
          </li>
          <li class="glossary-item" data-term="returns HTML">
            <div class="term">returns HTML</div>
            <div class="means">→ header "Content-Type" contains "text/html"</div>
          </li>
          <li class="glossary-item" data-term="they see">
            <div class="term">they see "{text}"</div>
            <div class="means">→ body contains "{text}"</div>
          </li>
          <li class="glossary-item" data-term="they don't see">
            <div class="term">they don't see "{text}"</div>
            <div class="means">→ body not contains "{text}"</div>
          </li>
          <li class="glossary-item" data-term="blog post exists">
            <div class="term">blog post exists</div>
            <div class="means">→ status 200, returns HTML</div>
          </li>
          <li class="glossary-item" data-term="page not found">
            <div class="term">page not found</div>
            <div class="means">→ status 404</div>
          </li>
        </ul>

        <div class="sidebar-title" style="margin-top: 20px;">Unit Testing Terms (6)</div>
        <ul class="glossary-list">
          <li class="glossary-item" data-term="generating a slug from a title">
            <div class="term">generating a slug from a title</div>
            <div class="means">→ call: slugify({title}), source: lib/text.tnt</div>
          </li>
          <li class="glossary-item" data-term="generating a slug from user input">
            <div class="term">generating a slug from user input</div>
            <div class="means">→ call: slugify({input}), input: corpus.strings</div>
          </li>
          <li class="glossary-item" data-term="slug is URL-safe">
            <div class="term">slug is URL-safe</div>
            <div class="means">→ check: invariant.url_slug (6 assertions)</div>
          </li>
          <li class="glossary-item" data-term="slug matches expected format">
            <div class="term">slug matches expected format</div>
            <div class="means">→ result is {expected}</div>
          </li>
          <li class="glossary-item" data-term="slug is predictable">
            <div class="term">slug is predictable</div>
            <div class="means">→ property: deterministic</div>
          </li>
          <li class="glossary-item" data-term="slug is stable">
            <div class="term">slug is stable</div>
            <div class="means">→ property: idempotent</div>
          </li>
        </ul>
      </div>
    </div>

    <!-- Popover element -->
    <div class="popover" id="popover">
      <div class="popover-title">
        <span id="popover-term">Term</span>
        <span class="term-badge glossary" id="popover-badge">GLOSSARY</span>
      </div>
      <div class="resolution-chain" id="popover-chain">
        <!-- Filled dynamically -->
      </div>
      <div class="primitive-checks" id="popover-primitives">
        <div class="primitive-checks-title">Executable Checks</div>
        <!-- Filled dynamically -->
      </div>
    </div>

    <div class="mockup-label">MOCKUP</div>

    <script>
      // Glossary definitions with their resolutions
      const glossary = {
        'a visitor goes to the home page': {
          means: 'GET /',
          primitive: true,
          check: 'fetch("/", { method: "GET" })'
        },
        'a visitor goes to the learn page': {
          means: 'GET /learn',
          primitive: true,
          check: 'fetch("/learn", { method: "GET" })'
        },
        'a visitor goes to the blog': {
          means: 'GET /blog',
          primitive: true,
          check: 'fetch("/blog", { method: "GET" })'
        },
        'page loads successfully': {
          means: 'status 200, returns HTML',
          children: [
            { term: 'status 200', primitive: true, check: 'Check(response.status == 200)' },
            { term: 'returns HTML', children: [
              { term: 'header "Content-Type" contains "text/html"', primitive: true, check: 'Check(headers["Content-Type"].includes("text/html"))' }
            ]}
          ]
        },
        'has proper layout': {
          means: 'has site branding, has navigation, body contains "footer"',
          children: [
            { term: 'has site branding', children: [
              { term: 'body contains "ntnt-logo"', primitive: true, check: 'Check(body.includes("ntnt-logo"))' },
              { term: 'body contains "NTNT"', primitive: true, check: 'Check(body.includes("NTNT"))' }
            ]},
            { term: 'has navigation', children: [
              { term: 'body contains "Learn"', primitive: true, check: 'Check(body.includes("Learn"))' },
              { term: 'body contains "Blog"', primitive: true, check: 'Check(body.includes("Blog"))' }
            ]},
            { term: 'body contains "footer"', primitive: true, check: 'Check(body.includes("footer"))' }
          ]
        },
        'has site branding': {
          means: 'body contains "ntnt-logo", body contains "NTNT"',
          children: [
            { term: 'body contains "ntnt-logo"', primitive: true, check: 'Check(body.includes("ntnt-logo"))' },
            { term: 'body contains "NTNT"', primitive: true, check: 'Check(body.includes("NTNT"))' }
          ]
        },
        'has navigation': {
          means: 'body contains "Learn", body contains "Blog"',
          children: [
            { term: 'body contains "Learn"', primitive: true, check: 'Check(body.includes("Learn"))' },
            { term: 'body contains "Blog"', primitive: true, check: 'Check(body.includes("Blog"))' }
          ]
        },
        'has powered badge': {
          means: 'body contains "Powered by NTNT", body contains "powered-badge"',
          children: [
            { term: 'body contains "Powered by NTNT"', primitive: true, check: 'Check(body.includes("Powered by NTNT"))' },
            { term: 'body contains "powered-badge"', primitive: true, check: 'Check(body.includes("powered-badge"))' }
          ]
        },
        'returns HTML': {
          means: 'header "Content-Type" contains "text/html"',
          primitive: true,
          check: 'Check(headers["Content-Type"].includes("text/html"))'
        },
        'they see': {
          means: 'body contains {text}',
          primitive: true,
          check: 'Check(body.includes("{text}"))'
        },
        "they don't see": {
          means: 'body not contains {text}',
          primitive: true,
          check: 'Check(!body.includes("{text}"))'
        },
        'blog post exists': {
          means: 'status 200, returns HTML',
          children: [
            { term: 'status 200', primitive: true, check: 'Check(response.status == 200)' },
            { term: 'returns HTML', children: [
              { term: 'header "Content-Type" contains "text/html"', primitive: true, check: 'Check(headers["Content-Type"].includes("text/html"))' }
            ]}
          ]
        },
        'page not found': {
          means: 'status 404',
          primitive: true,
          check: 'Check(response.status == 404)'
        },
        // Unit testing glossary terms
        'generating a slug from a title': {
          means: 'call: slugify({title}), source: lib/text.tnt, input: test_data.slugify_examples',
          children: [
            { term: 'call: slugify({title})', primitive: true, check: 'slugify(title)' },
            { term: 'source: lib/text.tnt', primitive: true, check: 'Load("lib/text.tnt")' },
            { term: 'input: test_data.slugify_examples', primitive: true, check: 'ForEach(test_data.slugify_examples)' }
          ]
        },
        'generating a slug from user input': {
          means: 'call: slugify({input}), source: lib/text.tnt, input: corpus.strings',
          children: [
            { term: 'call: slugify({input})', primitive: true, check: 'slugify(input)' },
            { term: 'source: lib/text.tnt', primitive: true, check: 'Load("lib/text.tnt")' },
            { term: 'input: corpus.strings', primitive: true, check: 'ForEach(corpus.strings) // 30 edge cases' }
          ]
        },
        'slug is URL-safe': {
          means: 'check: invariant.url_slug',
          children: [
            { term: 'uses only [a-z0-9-]', primitive: true, check: 'Check(result.matches(/^[a-z0-9-]+$/))' },
            { term: 'is lowercase', primitive: true, check: 'Check(result == result.toLowerCase())' },
            { term: 'does not start with "-"', primitive: true, check: 'Check(!result.startsWith("-"))' },
            { term: 'does not end with "-"', primitive: true, check: 'Check(!result.endsWith("-"))' },
            { term: 'does not contain "--"', primitive: true, check: 'Check(!result.includes("--"))' },
            { term: 'is non-empty', primitive: true, check: 'Check(result.length > 0)' }
          ]
        },
        'slug matches expected format': {
          means: 'result is {expected}',
          primitive: true,
          check: 'Check(result == expected)'
        },
        'slug is predictable': {
          means: 'property: deterministic',
          children: [
            { term: 'Call f(x) twice', primitive: true, check: 'r1 = slugify(x); r2 = slugify(x)' },
            { term: 'Results are equal', primitive: true, check: 'Check(r1 == r2)' }
          ]
        },
        'slug is stable': {
          means: 'property: idempotent',
          children: [
            { term: 'Call f(f(x))', primitive: true, check: 'r1 = slugify(x); r2 = slugify(r1)' },
            { term: 'Results are equal', primitive: true, check: 'Check(r1 == r2)' }
          ]
        },
        'uses only': {
          means: 'uses only {pattern}',
          primitive: true,
          check: 'Check(result.matches(/^{pattern}+$/))'
        },
        'is lowercase': {
          means: 'result is lowercase',
          primitive: true,
          check: 'Check(result == result.toLowerCase())'
        },
        'does not start with': {
          means: 'does not start with {prefix}',
          primitive: true,
          check: 'Check(!result.startsWith("{prefix}"))'
        },
        'does not end with': {
          means: 'does not end with {suffix}',
          primitive: true,
          check: 'Check(!result.endsWith("{suffix}"))'
        },
        'does not contain': {
          means: 'does not contain {text}',
          primitive: true,
          check: 'Check(!result.includes("{text}"))'
        },
        'is non-empty': {
          means: 'result is non-empty',
          primitive: true,
          check: 'Check(result.length > 0)'
        }
      };

      const popover = document.getElementById('popover');
      const popoverTerm = document.getElementById('popover-term');
      const popoverBadge = document.getElementById('popover-badge');
      const popoverChain = document.getElementById('popover-chain');
      const popoverPrimitives = document.getElementById('popover-primitives');

      // Build resolution chain HTML
      function buildResolutionChain(term, definition) {
        let html = '';
        let primitives = [];

        function addStep(item, level) {
          const levelClass = level === 0 ? '' : level === 1 ? 'level-1' : level === 2 ? 'level-2' : 'primitive';
          const termClass = item.primitive ? 'primitive' : levelClass;

          html += `
            <div class="resolution-step ${levelClass}">
              <span class="step-arrow">→</span>
              <span class="step-term ${termClass}">${item.term}</span>
            </div>
          `;

          if (item.primitive && item.check) {
            primitives.push(item.check);
          }

          if (item.children) {
            item.children.forEach(child => addStep(child, level + 1));
          }
        }

        // Start with the original term
        html += `
          <div class="resolution-step">
            <span class="step-arrow">→</span>
            <span class="step-term">${term}</span>
            <span class="step-source">glossary</span>
          </div>
        `;

        // If the definition is itself a primitive (direct mapping), show it as such
        if (definition.primitive) {
          html += `
            <div class="resolution-step primitive">
              <span class="step-arrow">→</span>
              <span class="step-term primitive">${definition.means}</span>
            </div>
          `;
          if (definition.check) {
            primitives.push(definition.check);
          }
        } else {
          // Add the "means" expansion
          html += `
            <div class="resolution-step level-1">
              <span class="step-arrow">→</span>
              <span class="step-term level-1">${definition.means}</span>
            </div>
          `;

          // Add children
          if (definition.children) {
            definition.children.forEach(child => addStep(child, 2));
          }
        }

        return { html, primitives };
      }

      // Handle mouse movement for glossary terms
      document.querySelectorAll('.glossary-term').forEach(term => {
        term.addEventListener('mouseenter', (e) => {
          const termKey = e.target.dataset.term;
          const definition = glossary[termKey];

          if (definition) {
            popoverTerm.textContent = termKey;
            const { html, primitives } = buildResolutionChain(termKey, definition);
            popoverChain.innerHTML = html;

            // Build primitives section
            if (primitives.length > 0) {
              popoverPrimitives.innerHTML = `
                <div class="primitive-checks-title">Executable Checks (${primitives.length})</div>
                ${primitives.map(p => `<div class="primitive-check"><span class="check-icon">✓</span> ${p}</div>`).join('')}
              `;
              popoverPrimitives.style.display = 'block';
            } else {
              popoverPrimitives.style.display = 'none';
            }

            popover.classList.add('visible');
          }
        });

        term.addEventListener('mouseleave', () => {
          popover.classList.remove('visible');
        });

        term.addEventListener('mousemove', (e) => {
          // Position popover to follow mouse
          const x = e.clientX + 20;
          const y = e.clientY + 10;

          // Keep popover in viewport
          const popoverRect = popover.getBoundingClientRect();
          const maxX = window.innerWidth - popoverRect.width - 20;
          const maxY = window.innerHeight - popoverRect.height - 20;

          popover.style.left = Math.min(x, maxX) + 'px';
          popover.style.top = Math.min(y, maxY) + 'px';
        });
      });

      // Sidebar glossary item click
      document.querySelectorAll('.glossary-item').forEach(item => {
        item.addEventListener('click', () => {
          const termKey = item.dataset.term;
          // Find and scroll to the first instance of this term
          const termEl = document.querySelector(`.glossary-term[data-term="${termKey}"]`);
          if (termEl) {
            termEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Flash highlight
            termEl.style.animation = 'flash 0.5s ease';
            setTimeout(() => termEl.style.animation = '', 500);
          }
        });
      });
    </script>

    <style>
      @keyframes flash {
        0%, 100% { box-shadow: 0 0 0 2px rgba(163, 113, 247, 0.3); }
        50% { box-shadow: 0 0 0 6px rgba(163, 113, 247, 0.5); }
      }
    </style>
  </body>
</html>
